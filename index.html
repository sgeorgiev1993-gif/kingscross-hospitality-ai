<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Kings Cross Hospitality Intelligence</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
:root{
  --bg:#0b0d12;
  --card:#121622;
  --accent:#f97316;
  --text:#e5e7eb;
  --muted:#9ca3af;
}

body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:var(--bg);
  color:var(--text);
}

.container{
  max-width:1100px;
  margin:auto;
  padding:24px;
}

h1{color:var(--accent)}
h2{margin-top:0}

.card{
  background:var(--card);
  border-radius:18px;
  padding:20px;
  margin-bottom:20px;
  box-shadow:0 20px 40px rgba(0,0,0,.4);
}

canvas{width:100%}

.muted{color:var(--muted);font-size:14px}

.badge{
  display:inline-block;
  padding:4px 10px;
  border-radius:12px;
  background:rgba(249,115,22,.15);
  color:#f97316;
  font-size:12px;
  margin-left:8px;
}
</style>
</head>

<body>
<div class="container">
  <h1>Kings Cross Hospitality Intelligence</h1>

  <!-- HISTORY -->
  <div class="card">
    <h2>
      24h Activity Signals
      <span class="badge">warming up</span>
    </h2>
    <canvas id="historyChart" height="260"></canvas>
    <p id="historyNote" class="muted">
      Showing current available signals. More detail appears as data accumulates.
    </p>
  </div>
</div>

<script>
async function loadJSON(p){
  try{
    const r = await fetch(p);
    if(!r.ok) return null;
    return await r.json();
  }catch{
    return null;
  }
}

function drawHistory(history){
  const c = document.getElementById("historyChart");
  const ctx = c.getContext("2d");

  const w = c.width = c.parentElement.clientWidth;
  const h = c.height;

  ctx.clearRect(0,0,w,h);

  history = history.slice(-24);

  const values = history.map(h=>h.busyness ?? 50);

  const max = Math.max(...values,100);
  const min = Math.min(...values,0);

  const x = i => i/(values.length-1 || 1) * w;
  const y = v => h - ((v-min)/(max-min || 1)) * (h-20) - 10;

  /* Grid */
  ctx.strokeStyle="rgba(255,255,255,0.06)";
  ctx.lineWidth=1;
  for(let i=0;i<=4;i++){
    const gy = i/4*h;
    ctx.beginPath();
    ctx.moveTo(0,gy);
    ctx.lineTo(w,gy);
    ctx.stroke();
  }

  /* Area fill */
  ctx.fillStyle="rgba(249,115,22,0.12)";
  ctx.beginPath();
  values.forEach((v,i)=>{
    const xi=x(i), yi=y(v);
    if(i===0) ctx.moveTo(xi, h);
    ctx.lineTo(xi, yi);
  });
  ctx.lineTo(w,h);
  ctx.closePath();
  ctx.fill();

  /* Main line */
  ctx.strokeStyle="#f97316";
  ctx.lineWidth=3;
  ctx.beginPath();
  values.forEach((v,i)=>{
    const xi=x(i), yi=y(v);
    ctx[i?"lineTo":"moveTo"](xi,yi);
  });
  ctx.stroke();

  /* Points */
  ctx.fillStyle="#f97316";
  values.forEach((v,i)=>{
    const xi=x(i), yi=y(v);
    ctx.beginPath();
    ctx.arc(xi,yi,4,0,Math.PI*2);
    ctx.fill();
  });

  /* Labels */
  ctx.fillStyle="#9ca3af";
  ctx.font="11px system-ui";
  history.forEach((p,i)=>{
    if(i%4!==0) return;
    const hr=new Date(p.timestamp).getHours();
    ctx.fillText(hr+":00",x(i)-10,h-6);
  });

  /* Summary note */
  const avg = Math.round(values.reduce((a,b)=>a+b,0)/values.length);
  document.getElementById("historyNote").textContent =
    `Average activity today: ${avg}/100 · ${values.length} data points collected`;
}

(async()=>{
  const history = await loadJSON("data/history/kingscross_history.json");
  if(history && history.length){
    drawHistory(history);
    window.__history = history;
  }else{
    document.getElementById("historyNote").textContent =
      "No history data yet — waiting for scheduled updates.";
  }
})();

window.addEventListener("resize",()=>{
  if(window.__history){
    drawHistory(window.__history);
  }
});
</script>
</body>
</html>
</html>
