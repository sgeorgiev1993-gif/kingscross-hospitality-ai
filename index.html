<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kings Cross Live Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; background: #fafafa; padding: 40px; }
    h1,h2,h3 { color:#333; }
    img { max-width:90%; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.1); margin-bottom:20px; }
    .event-section { max-width:600px; margin: 0 auto 20px; text-align:left; background:#fff; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.05); padding:10px; }
    .event-section button { width:100%; text-align:left; background:#007bff; color:#fff; padding:8px 12px; border:none; border-radius:6px; font-size:1em; cursor:pointer; margin-bottom:8px; }
    .event-section button:hover { background:#0056b3; }
    .event-list { list-style:none; padding:0; display:none; margin:0; }
    .event-list li { padding:8px 12px; border-bottom:1px solid #eee; }
    .event-list li a { color:#007bff; text-decoration:none; font-weight:600; }
    .event-list li a:hover { text-decoration:underline; }
    footer { margin-top:40px; font-size:0.85em; color:#777; }
  </style>
</head>
<body>
  <h1>üèôÔ∏è Kings Cross Live Dashboard</h1>
  <p>Updated automatically every hour</p>
  <button onclick="refreshPage()">üîÑ Refresh Now</button>
  <img id="dashboardImg" src="data/kingscross_dashboard.png" alt="Current Dashboard">

  <h2>üé´ Upcoming Events in King‚Äôs Cross</h2>
  <div id="eventsContainer">Loading events...</div>

  <footer>
    Data sources: OpenWeather, TfL, Eventbrite, Meetup, Ticketmaster | Dashboard generated with Python & GitHub Actions
  </footer>

  <script>
    function refreshPage() { location.reload(); }
    setTimeout(() => location.reload(), 3600000); // reload every hour

    fetch('data/events.json')
      .then(r => r.json())
      .then(events => {
        const container = document.getElementById('eventsContainer');
        container.innerHTML = '';

        if(events.length === 0){
          container.innerHTML = '<p>No upcoming events found.</p>';
          return;
        }

        const sources = ["Eventbrite","Meetup","Ticketmaster"];
        sources.forEach(source => {
          const section = document.createElement('div');
          section.className = 'event-section';

          const button = document.createElement('button');
          button.textContent = `‚ñ∂ ${source} Events`;
          section.appendChild(button);

          const ul = document.createElement('ul');
          ul.className = 'event-list';
          events.filter(e => e.source === source).slice(0,20).forEach(ev => {
            const li = document.createElement('li');
            li.innerHTML = `<a href="${ev.url}" target="_blank">${ev.name}</a> ‚Äî ${new Date(ev.start).toLocaleString()}`;
            ul.appendChild(li);
          });
          section.appendChild(ul);

          button.addEventListener('click', () => {
            const visible = ul.style.display === 'block';
            ul.style.display = visible ? 'none' : 'block';
            button.textContent = (visible ? '‚ñ∂ ' : '‚ñº ') + source + ' Events';
          });

          container.appendChild(section);
        });
      })
      .catch(err => {
        document.getElementById('eventsContainer').innerHTML = '<p>Error loading events.</p>';
        console.error(err);
      });
  </script>
</body>
</html>