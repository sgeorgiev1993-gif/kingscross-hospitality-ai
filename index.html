<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Kings Cross Hospitality Intelligence</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
body{
  margin:0;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
  background:#0b0d12;
  color:#e5e7eb;
}
.container{max-width:1100px;margin:auto;padding:24px}
h1{color:#f97316}
.card{
  background:#121622;
  border-radius:18px;
  padding:20px;
  margin-bottom:20px;
  box-shadow:0 20px 40px rgba(0,0,0,.4)
}
canvas{width:100%}
.muted{color:#9ca3af;font-size:14px}
.good{color:#22c55e}
.bad{color:#f87171}
.legend span{margin-right:16px;font-size:13px}
.legend i{display:inline-block;width:12px;height:12px;margin-right:6px;border-radius:3px}
</style>
</head>

<body>
<div class="container">
<h1>Kings Cross Hospitality Intelligence</h1>

<div class="card">
<h2>Weather</h2>
<p id="weather" class="muted">Loading…</p>
</div>

<div class="card">
<h2>Transport Status</h2>
<ul id="transport"></ul>
</div>

<div class="card">
<h2>Next 12h Forecast</h2>
<canvas id="forecastChart" height="260"></canvas>
<div class="legend">
  <span><i style="background:#f97316"></i>Expected</span>
  <span><i style="background:rgba(249,115,22,.3)"></i>Confidence range</span>
  <span><i style="background:rgba(249,115,22,.1)"></i>Rush hour</span>
</div>
<p id="forecastNote" class="muted"></p>
</div>

<div class="card">
<h2>Why demand changes</h2>
<ul id="explanations"></ul>
</div>
</div>

<script>
async function loadJSON(p){try{return await (await fetch(p)).json()}catch{return null}}

function drawForecast(canvasId,data){
  const c=document.getElementById(canvasId);
  const ctx=c.getContext("2d");
  const w=c.width=c.offsetWidth;
  const h=c.height;
  ctx.clearRect(0,0,w,h);

  const max=Math.max(...data.map(d=>d.high||d.busyness),100);
  const min=0;
  const x=i=>i/(data.length-1)*w;
  const y=v=>h-((v-min)/(max-min||1))*h;

  // Rush hour shading
  data.forEach((p,i)=>{
    if(p.rush_hour){
      ctx.fillStyle="rgba(249,115,22,.1)";
      ctx.fillRect(x(i)-w/data.length/2,0,w/data.length,h);
    }
  });

  // Confidence band
  ctx.fillStyle="rgba(249,115,22,.25)";
  ctx.beginPath();
  data.forEach((p,i)=>ctx[i?"lineTo":"moveTo"](x(i),y(p.high||p.busyness)));
  for(let i=data.length-1;i>=0;i--){
    ctx.lineTo(x(i),y(data[i].low||data[i].busyness));
  }
  ctx.closePath();ctx.fill();

  // Main line
  ctx.strokeStyle="#f97316";
  ctx.lineWidth=3;
  ctx.beginPath();
  data.forEach((p,i)=>ctx[i?"lineTo":"moveTo"](x(i),y(p.busyness)));
  ctx.stroke();

  // Time labels
  ctx.fillStyle="#9ca3af";
  ctx.font="11px system-ui";
  data.forEach((p,i)=>{
    if(i%3===0){
      const t=new Date(p.time);
      ctx.fillText(t.getHours()+":00",x(i)-10,h-5);
    }
  });
}

(async()=>{
  const dash=await loadJSON("data/kingscross_dashboard.json");
  const forecast=await loadJSON("data/forecast.json");

  // Weather
  document.getElementById("weather").textContent=
    dash?.weather?.temperature_C!==undefined
    ?`${dash.weather.temperature_C}°C, Wind ${dash.weather.windspeed_kmh} km/h (${dash.weather.condition})`
    :"Weather unavailable";

  // Transport
  (dash?.tfl||[]).forEach(l=>{
    const li=document.createElement("li");
    li.innerHTML=`<strong>${l.name}</strong>: <span class="${l.status==='Good Service'?'good':'bad'}">${l.status}</span>`;
    transport.appendChild(li);
  });

  // Forecast
  if(forecast){
    drawForecast("forecastChart",forecast);
    forecastNote.textContent=`Confidence: ${forecast[0]?.confidence||"low"}`;
  }

  // Explanations
  forecast?.slice(0,4).forEach(f=>{
    const li=document.createElement("li");
    li.textContent=
      f.reason==="event nearby"?"Nearby event increasing footfall":
      f.rush_hour?"Rush-hour commuter traffic":
      "Baseline local demand";
    explanations.appendChild(li);
  });
})();
</script>
</body>
</html>
