<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Kings Cross Hospitality Intelligence</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
body {
  margin:0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background:#0b0d12;
  color:#e5e7eb;
}
.container {
  max-width:1100px;
  margin:auto;
  padding:24px;
}
h1 {
  color:#f97316;
  margin-bottom:20px;
}
.card {
  background:#121622;
  border-radius:18px;
  padding:20px;
  margin-bottom:20px;
  box-shadow:0 20px 40px rgba(0,0,0,0.4);
}
canvas {
  width:100%;
}
.muted {
  color:#9ca3af;
  font-size:14px;
}
.good { color:#22c55e; }
.bad { color:#f87171; }
.warn { color:#fbbf24; }
a { color:#f97316; text-decoration:none; }
ul { padding-left:18px; }
li { margin-bottom:6px; }
.legend {
  display:flex;
  gap:16px;
  margin-top:10px;
  font-size:13px;
}
.legend span {
  display:flex;
  align-items:center;
  gap:6px;
}
.box {
  width:14px;
  height:14px;
  border-radius:3px;
}
</style>
</head>

<body>
<div class="container">
  <h1>Kings Cross Hospitality Intelligence</h1>

  <div class="card">
    <h2>Weather</h2>
    <p id="weather" class="muted">Loading…</p>
  </div>

  <div class="card">
    <h2>Transport Status</h2>
    <ul id="transport"></ul>
  </div>

  <div class="card">
    <h2>Next 12h Forecast</h2>
    <canvas id="forecastChart" height="240"></canvas>
    <div class="legend">
      <span><div class="box" style="background:#fb923c"></div>Forecast</span>
      <span><div class="box" style="background:rgba(251,146,60,.2)"></div>Rush hour</span>
    </div>
  </div>
</div>

<script>
async function loadJSON(path){
  try { return await (await fetch(path)).json() }
  catch { return null }
}

(async()=>{
  const dashboard = await loadJSON("data/kingscross_dashboard.json");
  const forecast = await loadJSON("data/forecast.json");

  // -------- WEATHER --------
  if(dashboard?.weather?.temperature_C !== undefined){
    document.getElementById("weather").textContent =
      `${dashboard.weather.temperature_C}°C, Wind ${dashboard.weather.windspeed_kmh} km/h (${dashboard.weather.condition})`;
  } else {
    document.getElementById("weather").textContent = "Weather data unavailable";
  }

  // -------- TRANSPORT --------
  const t = document.getElementById("transport");
  if(dashboard?.tfl?.length){
    dashboard.tfl.forEach(l=>{
      const li=document.createElement("li");
      li.innerHTML=`<strong>${l.name}</strong>: <span class="${l.status==='Good Service'?'good':'bad'}">${l.status}</span>`;
      t.appendChild(li);
    });
  } else {
    t.innerHTML = "<li class='muted'>No transport data</li>";
  }

  // -------- FORECAST CHART --------
  if(forecast?.length){
    drawForecast(forecast, "forecastChart");
  }
})();

function drawForecast(data,id){
  const c=document.getElementById(id);
  const ctx=c.getContext("2d");
  const w=c.width=c.offsetWidth;
  const h=c.height;

  const vals = data.map(d=>d.busyness);
  const max = Math.max(...vals, 100);

  // ----- Rush hour background -----
  data.forEach((d,i)=>{
    if(d.rush_hour){
      const x1 = (i/data.length)*w;
      const x2 = ((i+1)/data.length)*w;
      ctx.fillStyle = "rgba(251,146,60,0.18)";
      ctx.fillRect(x1,0,x2-x1,h);
    }
  });

  // ----- Line -----
  ctx.beginPath();
  ctx.strokeStyle="#fb923c";
  ctx.lineWidth=2;

  data.forEach((d,i)=>{
    const x=i/(data.length-1)*w;
    const y=h-(d.busyness/max)*h;
    i?ctx.lineTo(x,y):ctx.moveTo(x,y);
  });
  ctx.stroke();

  // ----- Points -----
  data.forEach((d,i)=>{
    const x=i/(data.length-1)*w;
    const y=h-(d.busyness/max)*h;
    ctx.beginPath();
    ctx.fillStyle=d.rush_hour?"#f97316":"#e5e7eb";
    ctx.arc(x,y,4,0,Math.PI*2);
    ctx.fill();
  });
}
</script>
</body>
</html>