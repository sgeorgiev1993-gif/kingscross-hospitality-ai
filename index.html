<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Kings Cross Hospitality Intelligence</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
body {
  margin:0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background:#0b0d12;
  color:#e5e7eb;
}
.container {
  max-width:1100px;
  margin:auto;
  padding:24px;
}
h1 {
  color:#f97316;
  margin-bottom:20px;
}
.card {
  background:#121622;
  border-radius:18px;
  padding:20px;
  margin-bottom:20px;
  box-shadow:0 20px 40px rgba(0,0,0,0.4);
}
canvas { width:100%; }
.muted { color:#9ca3af; font-size:14px; }
.good { color:#22c55e; }
.bad { color:#f87171; }
.warn { color:#fbbf24; }
ul { padding-left:18px; }
li { margin-bottom:6px; }
</style>
</head>

<body>
<div class="container">
  <h1>Kings Cross Hospitality Intelligence</h1>

  <div class="card">
    <h2>Weather</h2>
    <p id="weather" class="muted">Loading…</p>
  </div>

  <div class="card">
    <h2>Transport Status</h2>
    <ul id="transport"></ul>
  </div>

 <div class="card">
  <h2>Next 12h Forecast</h2>
  <canvas id="forecastChart" height="240"></canvas>
  <p id="forecastNote" class="muted"></p>
  <ul id="eventMarkers" class="muted"></ul>
</div>
</div>

<script>
async function loadJSON(path){
  try {
    const r = await fetch(path);
    if(!r.ok) throw new Error(path);
    return await r.json();
  } catch(e){
    console.warn("Failed:", path);
    return null;
  }
}

function drawLine(values, canvasId, color){
  if(!values?.length) return;
  const c=document.getElementById(canvasId);
  const ctx=c.getContext("2d");
  const w=c.width=c.offsetWidth;
  const h=c.height;
  const max=Math.max(...values,100);

  ctx.beginPath();
  ctx.strokeStyle=color;
  ctx.lineWidth=2;

  values.forEach((v,i)=>{
    const x=i/(values.length-1)*w;
    const y=h-(v/max)*h;
    i?ctx.lineTo(x,y):ctx.moveTo(x,y);
  });
  ctx.stroke();
}

(async()=>{
  const dash = await loadJSON("data/kingscross_dashboard.json");
  const forecast = await loadJSON("data/forecast.json");

  /* WEATHER */
  const wEl=document.getElementById("weather");
  if(dash?.weather?.temperature_C!=null){
    wEl.textContent=`${dash.weather.temperature_C}°C, Wind ${dash.weather.windspeed_kmh} km/h (${dash.weather.condition})`;
  } else {
    wEl.textContent="Weather data unavailable";
  }

  /* TRANSPORT */
  const tEl=document.getElementById("transport");
  if(dash?.tfl?.length){
    dash.tfl.forEach(l=>{
      const li=document.createElement("li");
      li.textContent=`${l.name}: ${l.status}`;
      tEl.appendChild(li);
    });
  } else {
    tEl.innerHTML="<li class='muted'>No transport data</li>";
  }

  /* FORECAST */
  if(forecast?.length){
    drawLine(forecast.map(f=>f.busyness),"forecastChart","#f97316");
    document.getElementById("forecastNote").textContent =
      `Forecast confidence: ${forecast[0].confidence}`;
  } else {
    document.getElementById("forecastNote").textContent="Forecast not available";
  }
})();
</script>
</body>
</html>
