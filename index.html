<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kings Cross Dashboard</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f4; }
  h1 { text-align: center; }
  .dashboard { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; }
  .card { background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); width: 300px; }
  .card img { max-width: 100%; border-radius: 5px; margin-top: 10px; }
  ul { padding-left: 20px; }
  li { margin-bottom: 5px; }
  .status-good { color: green; font-weight: bold; }
  .status-minor { color: orange; font-weight: bold; }
  .status-severe { color: red; font-weight: bold; }
  .status-other { color: gray; }
  .today-event { font-weight: bold; }
</style>
</head>
<body>
<h1>Kings Cross Dashboard</h1>

<div class="dashboard">
  <div class="card">
    <h2>Weather</h2>
    <p id="weather"></p>
  </div>

  <div class="card">
    <h2>TfL Status</h2>
    <ul id="tfl"></ul>
  </div>

  <div class="card">
    <h2>Events</h2>
    <ul id="events"></ul>
  </div>

  <div class="card">
    <h2>Dashboard Images</h2>
    <img src="data/kingscross_dashboard.png" alt="Dashboard">
    <img src="data/kingscross_temp_24h_tfl.png" alt="Last 24h Temp + TfL">
  </div>
</div>

<script>
function getStatusClass(status) {
  switch(status) {
    case 'Good Service': return 'status-good';
    case 'Minor Delays': return 'status-minor';
    case 'Severe Delays': return 'status-severe';
    default: return 'status-other';
  }
}

async function loadDashboard() {
  // --- Weather ---
  const weatherResp = await fetch('data/kingscross_weather.json');
  const weather = await weatherResp.json();
  document.getElementById('weather').innerText = 
    `Temperature: ${weather.temperature_C}Â°C\nWind Speed: ${weather.windspeed_kmh} km/h\nWeather Code: ${weather.weather_code}`;

  // --- TfL ---
  const tflResp = await fetch('data/kingscross_tfl.json');
  const tfl = await tflResp.json();
  const tflList = document.getElementById('tfl');
  tflList.innerHTML = '';
  tfl.forEach(line => {
    const li = document.createElement('li');
    li.innerText = `${line.name} (${line.mode}): ${line.status}`;
    li.className = getStatusClass(line.status);
    tflList.appendChild(li);
  });

  // --- Events ---
  const eventsResp = await fetch('data/events.json');
  const events = await eventsResp.json();
  const eventsList = document.getElementById('events');
  eventsList.innerHTML = '';
  const today = new Date().toISOString().slice(0,10);
  if (events.length === 0) {
    eventsList.innerHTML = '<li>No upcoming events</li>';
  } else {
    events.forEach(ev => {
      const evDate = ev.start.slice(0,10);
      const li = document.createElement('li');
      li.innerHTML = `<a href="${ev.url}" target="_blank">${ev.name}</a> - ${new Date(ev.start).toLocaleString()}`;
      if(evDate === today) li.classList.add('today-event');
      eventsList.appendChild(li);
    });
  }
}

loadDashboard();
</script>
</body>
</html>