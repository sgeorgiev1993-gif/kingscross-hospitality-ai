<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Kings Cross Hospitality Intelligence</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
:root{
  --bg:#0b0d12;
  --card:#121622;
  --accent:#f97316;
  --accent-soft:rgba(249,115,22,.18);
  --accent-rush:rgba(249,115,22,.08);
  --blue:#60a5fa;
  --red:#f87171;
  --text:#e5e7eb;
  --muted:#9ca3af;
}

body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:var(--bg);
  color:var(--text);
}

.container{
  max-width:1100px;
  margin:auto;
  padding:24px;
}

h1{color:var(--accent)}
h2{margin-top:0}

.card{
  background:var(--card);
  border-radius:18px;
  padding:20px;
  margin-bottom:20px;
  box-shadow:0 20px 40px rgba(0,0,0,.4);
}

canvas{width:100%}

.legend{
  display:flex;
  gap:16px;
  margin-top:10px;
  font-size:13px;
}
.legend span::before{
  content:"";
  display:inline-block;
  width:12px;
  height:12px;
  margin-right:6px;
  border-radius:3px;
}
.l-busy::before{background:var(--accent)}
.l-temp::before{background:var(--blue)}
.l-stress::before{background:var(--red)}
</style>
</head>

<body>
<div class="container">
  <h1>Kings Cross Hospitality Intelligence</h1>

  <!-- HISTORY -->
  <div class="card">
    <h2>24h Activity Signals</h2>
    <canvas id="historyChart" height="260"></canvas>
    <div class="legend">
      <span class="l-busy">Busyness</span>
      <span class="l-temp">Temperature (Â°C)</span>
      <span class="l-stress">Transport stress</span>
    </div>
    <p class="muted">
      Combined signals from weather, transport disruption and local activity.
    </p>
  </div>
</div>

<script>
async function loadJSON(p){
  try{
    const r = await fetch(p);
    if(!r.ok) return null;
    return await r.json();
  }catch{
    return null;
  }
}

/* ---------- HISTORY CHART ---------- */
function drawHistory(history){
  const c = document.getElementById("historyChart");
  const ctx = c.getContext("2d");

  const w = c.width = c.parentElement.clientWidth;
  const h = c.height;

  ctx.clearRect(0,0,w,h);

  history = history.slice(-24);
  const busyness = history.map(h=>h.busyness ?? 50);
  const temps = history.map(h=>h.temperature ?? null);
  const stress = history.map(h=>h.transport_stress ?? null);

  const maxBusy = Math.max(...busyness,100);
  const maxTemp = Math.max(...temps.filter(Boolean),25);
  const maxStress = Math.max(...stress.filter(Boolean),40);

  const x = i => i/(history.length-1||1) * w;
  const yBusy = v => h - (v/maxBusy)*h;
  const yTemp = v => h - (v/maxTemp)*h;
  const yStress = v => h - (v/maxStress)*h;

  /* Busyness */
  ctx.strokeStyle = "#f97316";
  ctx.lineWidth = 2.5;
  ctx.beginPath();
  busyness.forEach((v,i)=>ctx[i?"lineTo":"moveTo"](x(i),yBusy(v)));
  ctx.stroke();

  /* Temperature */
  if(temps.some(Boolean)){
    ctx.strokeStyle = "#60a5fa";
    ctx.lineWidth = 2;
    ctx.beginPath();
    temps.forEach((v,i)=>{
      if(v==null) return;
      ctx[i?"lineTo":"moveTo"](x(i),yTemp(v));
    });
    ctx.stroke();
  }

  /* Transport stress */
  if(stress.some(Boolean)){
    ctx.strokeStyle = "#f87171";
    ctx.setLineDash([6,4]);
    ctx.beginPath();
    stress.forEach((v,i)=>{
      if(v==null) return;
      ctx[i?"lineTo":"moveTo"](x(i),yStress(v));
    });
    ctx.stroke();
    ctx.setLineDash([]);
  }

  /* Hour labels */
  ctx.fillStyle="#9ca3af";
  ctx.font="11px system-ui";
  history.forEach((p,i)=>{
    if(i%4!==0) return;
    const hr = new Date(p.timestamp).getHours();
    ctx.fillText(hr+":00",x(i)-10,h-6);
  });
}

/* ---------- LOAD ---------- */
(async()=>{
  const history = await loadJSON("data/history/kingscross_history.json");
  if(history && history.length){
    drawHistory(history);
    window.__history = history;
  }
})();

window.addEventListener("resize",()=>{
  if(window.__history){
    drawHistory(window.__history);
  }
});
</script>
</body>
</html>
