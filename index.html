<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Kings Cross Hospitality Intelligence</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  margin:0;
  font-family: system-ui, sans-serif;
  background:#0b0d12;
  color:#e5e7eb;
}
.container {
  max-width:1100px;
  margin:auto;
  padding:24px;
}
.card {
  background:#121622;
  border-radius:16px;
  padding:20px;
  margin-bottom:20px;
}
h1 { color:#f97316; }
canvas { width:100%; }
.muted { color:#9ca3af; font-size:14px; }
</style>
</head>

<body>
<div class="container">
  <h1>Kings Cross Hospitality Intelligence</h1>

  <div class="card">
    <h2>Weather</h2>
    <p id="weather">Loading…</p>
  </div>

  <div class="card">
    <h2>24h Activity Signals</h2>
    <canvas id="chart" height="260"></canvas>
    <p class="muted">Busyness (orange) · Temperature (blue) · Transport stress (red)</p>
  </div>
</div>

<script>
async function loadJSON(p){
  try { return await (await fetch(p)).json(); }
  catch { return null; }
}

(async()=>{
  const dash = await loadJSON("data/kingscross_dashboard.json");
  if(dash){
    document.getElementById("weather").textContent =
      `${dash.weather.temperature_C}°C, Wind ${dash.weather.windspeed_kmh} km/h`;
  }

  const hist = await loadJSON("data/history/signals_history.json");
  if(!hist || hist.length < 2) return;

  const ctx = document.getElementById("chart").getContext("2d");
  const w = ctx.canvas.width = ctx.canvas.offsetWidth;
  const h = ctx.canvas.height;

  const data = hist.slice(-24);
  const b = data.map(d=>d.busyness);
  const t = data.map(d=>d.temperature);
  const s = data.map(d=>d.transport_stress);

  const max = v => Math.max(...v,1);

  function line(vals,color,scale){
    ctx.beginPath();
    ctx.strokeStyle=color;
    ctx.lineWidth=2;
    vals.forEach((v,i)=>{
      const x=i/(vals.length-1)*w;
      const y=h-(v/scale)*h;
      i?ctx.lineTo(x,y):ctx.moveTo(x,y);
    });
    ctx.stroke();
  }

  ctx.clearRect(0,0,w,h);
  line(b,"#f97316",max(b));
  line(t,"#3b82f6",max(t));
  line(s,"#dc2626",max(s));
})();
</script>
</body>
</html>