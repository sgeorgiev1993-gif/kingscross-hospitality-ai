<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Kings Cross Hospitality Intelligence</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{margin:0;font-family:system-ui;background:#0b0d12;color:#e5e7eb}
.container{max-width:1100px;margin:auto;padding:24px}
h1{color:#f97316}
.card{background:#121622;border-radius:18px;padding:20px;margin-bottom:20px}
canvas{width:100%}
.muted{color:#9ca3af;font-size:14px}
.good{color:#22c55e}.bad{color:#f87171}
</style>
</head>

<body>
<div class="container">
<h1>Kings Cross Hospitality Intelligence</h1>

<div class="card">
<h2>Weather</h2>
<p id="weather" class="muted">Loading…</p>
</div>

<div class="card">
<h2>Transport Status</h2>
<ul id="transport"></ul>
</div>

<div class="card">
<h2>24h Activity</h2>
<canvas id="history" height="220"></canvas>
<p class="muted" id="samples"></p>
</div>

<div class="card">
<h2>Next 12h Forecast</h2>
<canvas id="forecast" height="220"></canvas>
</div>
</div>

<script>
async function load(p){try{return await (await fetch(p)).json()}catch{return null}}

function drawLine(ctx,data,color){
  ctx.strokeStyle=color;ctx.lineWidth=2;ctx.beginPath()
  data.forEach((v,i)=>{
    const x=i/(data.length-1)*ctx.canvas.width
    const y=ctx.canvas.height-(v/100)*ctx.canvas.height
    i?ctx.lineTo(x,y):ctx.moveTo(x,y)
  })
  ctx.stroke()
}

(async()=>{
const dash = await load("data/kingscross_dashboard.json")
if(dash?.weather?.temperature_C!==undefined){
  weather.textContent=`${dash.weather.temperature_C}°C, Wind ${dash.weather.windspeed_kmh} km/h`
}else weather.textContent="Weather data unavailable"

dash?.tfl?.forEach(l=>{
  const li=document.createElement("li")
  li.innerHTML=`${l.name}: <span class="${l.status==='Good Service'?'good':'bad'}">${l.status}</span>`
  transport.appendChild(li)
})

const hist = await load("data/kingscross_history.json")
if(hist?.length){
  samples.textContent=`Samples: ${hist.length}`
  const c=document.getElementById("history").getContext("2d")
  drawLine(c,hist.map(h=>h.busyness),"#f97316")
}

const fc = await load("data/forecast.json")
if(fc?.length){
  const c=document.getElementById("forecast").getContext("2d")
  drawLine(c,fc.map(f=>f.low),"#334155")
  drawLine(c,fc.map(f=>f.high),"#334155")
  drawLine(c,fc.map(f=>f.busyness),"#fb923c")
}
})();
</script>
</body>
</html>
