<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Kings Cross Hospitality Intelligence</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
:root{
  --bg:#0b0d12;
  --card:#121622;
  --accent:#f97316;
  --temp:#38bdf8;
  --stress:#f87171;
  --text:#e5e7eb;
  --muted:#9ca3af;
}

body{
  margin:0;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
  background:var(--bg);
  color:var(--text);
}

.container{
  max-width:1100px;
  margin:auto;
  padding:24px;
}

h1{color:var(--accent)}
h2{margin-top:0}

.card{
  background:var(--card);
  border-radius:18px;
  padding:20px;
  margin-bottom:20px;
  box-shadow:0 20px 40px rgba(0,0,0,.4);
}

canvas{width:100%}

.muted{color:var(--muted);font-size:14px}

.legend{
  display:flex;
  gap:16px;
  font-size:13px;
  margin-top:10px;
}
.legend span::before{
  content:"";
  display:inline-block;
  width:12px;
  height:12px;
  border-radius:3px;
  margin-right:6px;
}
.l-busyness::before{background:var(--accent)}
.l-temp::before{background:var(--temp)}
.l-stress::before{background:var(--stress)}
</style>
</head>

<body>
<div class="container">
  <h1>Kings Cross Hospitality Intelligence</h1>

  <div class="card">
    <h2>24h Activity Signals</h2>
    <canvas id="historyChart" height="260"></canvas>

    <div class="legend">
      <span class="l-busyness">Busyness</span>
      <span class="l-temp">Temperature (Â°C)</span>
      <span class="l-stress">Transport stress</span>
    </div>

    <p class="muted">
      Combined signals from weather, transport disruption and local activity.
    </p>
  </div>
</div>

<script>
async function loadJSON(path){
  try{
    const r = await fetch(path);
    if(!r.ok) return null;
    return await r.json();
  }catch{ return null }
}

function drawMultiLine(canvasId, series){
  const c = document.getElementById(canvasId);
  const ctx = c.getContext("2d");

  const w = c.width = c.offsetWidth;
  const h = c.height;

  ctx.clearRect(0,0,w,h);

  const allValues = series.flatMap(s => s.values);
  const max = Math.max(...allValues, 100);
  const min = Math.min(...allValues, 0);

  const x = i => i/(series[0].values.length-1) * w;
  const y = v => h - ((v-min)/(max-min||1)) * h;

  series.forEach(s=>{
    ctx.beginPath();
    ctx.strokeStyle = s.color;
    ctx.lineWidth = 2.5;

    s.values.forEach((v,i)=>{
      i ? ctx.lineTo(x(i), y(v)) : ctx.moveTo(x(i), y(v));
    });

    ctx.stroke();
  });
}

(async()=>{
  const history = await loadJSON("data/history/kingscross_history.json");

  if(!history || history.length < 2){
    const ctx = document.getElementById("historyChart").getContext("2d");
    ctx.fillStyle="#9ca3af";
    ctx.fillText("Not enough data yet",20,40);
    return;
  }

  const recent = history.slice(-24);

  drawMultiLine("historyChart",[
    {
      label:"Busyness",
      color:"#f97316",
      values: recent.map(h=>h.busyness ?? 50)
    },
    {
      label:"Temperature",
      color:"#38bdf8",
      values: recent.map(h=>h.temperature ?? 12)
    },
    {
      label:"Transport stress",
      color:"#f87171",
      values: recent.map(h=>h.transport_stress ?? 0)
    }
  ]);
})();
</script>
</body>
</html>
