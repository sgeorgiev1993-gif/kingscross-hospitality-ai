name: Test OpenWeather API

on:
  workflow_dispatch:

jobs:
  test-weather:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      - name: Install requests
        run: pip install requests

      - name: Test OpenWeather API
        env:
          OPENWEATHER_KEY: ${{ secrets.OPENWEATHER_KEY }}
        run: |
          python - <<EOF
          import requests

          lat, lon = 51.5308, -0.1238  # Kings Cross
          api_key = "${{ secrets.OPENWEATHER_KEY }}"
          url = f"https://api.openweathermap.org/data/2.5/weather?lat={lat}&lon={lon}&appid={api_key}&units=metric"

          r = requests.get(url)
          if r.status_code == 200:
              data = r.json()
              weather = data['weather'][0]['description']
              temp = data['main']['temp']
              print(f"✅ Weather in Kings Cross: {weather}, {temp}°C")
          else:
              print(f"❌ Failed: {r.status_code}, {r.text}")
          EOF
