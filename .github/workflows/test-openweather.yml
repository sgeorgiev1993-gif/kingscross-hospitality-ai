name: Debug OpenWeather API Key

on:
  workflow_dispatch:

jobs:
  test-openweather:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests

      - name: Check OpenWeather API Key
        env:
          OPENWEATHER_KEY: ${{ secrets.OPENWEATHER_KEY }}
        run: |
          echo "üîç Checking if secret exists..."
          if [ -z "$OPENWEATHER_KEY" ]; then
            echo "‚ùå Secret OPENWEATHER_KEY is missing or empty!"
            exit 1
          else
            echo "‚úÖ OPENWEATHER_KEY exists (value hidden for security)."
          fi

      - name: Test OpenWeather API
        env:
          OPENWEATHER_KEY: ${{ secrets.OPENWEATHER_KEY }}
        run: |
          python - <<'EOF'
          import os, requests

          lat, lon = 51.5308, -0.1238
          api_key = os.environ.get("OPENWEATHER_KEY")
          url = f"https://api.openweathermap.org/data/2.5/weather?lat={lat}&lon={lon}&appid={api_key}&units=metric"

          r = requests.get(url)
          print("üîç Response status:", r.status_code)
          if r.status_code == 200:
              data = r.json()
              weather = data['weather'][0]['description']
              temp = data['main']['temp']
              print(f"‚úÖ Success! Weather in Kings Cross: {weather}, {temp}¬∞C")
          else:
              print(f"‚ùå API failed: {r.status_code}, {r.text}")
          EOF
